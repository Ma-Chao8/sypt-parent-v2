<!DOCTYPE HTML>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<meta charset="utf-8">
<head th:include="include :: header"></head>

	<body>
		<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页
			<span class="c-gray en">&gt;</span> 系统管理
			<span class="c-gray en">&gt;</span> 流程记录
			<a class="btn btn-success radius r" style="line-height:1em" href="javascript:location.replace(location.href);" title="刷新"><i class="fa fa-refresh"></i></a>
		</nav>
		
		<div class="page-container" id="dataContainer">
			<div class="cl pd-5 bg-1 bk-gray mt-20">
				<span class="r">
					<i class="Hui-iconfont Hui-iconfont-lunzi"></i>
		        </span>
				<span class="l">
					流程显示
				</span>
			</div>

			<!--<form action="" method="post" class="form form-horizontal" id="form-article-add" style="">-->
				<!--<h2>杀青</h2>-->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">操作流程：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">负责人：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">工艺名称：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" name="" id="" placeholder="" value="" class="input-text">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
			<!--</form>-->
			<!---->
			<!--<form action="" method="post" class="form form-horizontal" id="form-article-add" style="">-->
				<!--<h2>初揉</h2>-->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">操作流程：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">负责人：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">工艺名称：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" name="" id="" placeholder="" value="" class="input-text">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
			<!--</form>-->
			<!---->
			<!--<form action="" method="post" class="form form-horizontal" id="form-article-add" style="">-->
				<!--<h2>渥堆</h2>-->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">操作流程：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">负责人：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">工艺名称：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" name="" id="" placeholder="" value="" class="input-text">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
			<!--</form>-->
			<!---->
			<!--<form action="" method="post" class="form form-horizontal" id="form-article-add" style="">-->
				<!--<h2>金花黑茶</h2>-->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">操作流程：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">负责人：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">工艺名称：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" name="" id="" placeholder="" value="" class="input-text">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
			<!--</form>-->
			<!---->
			<!--<form action="" method="post" class="form form-horizontal" id="form-article-add" style="">-->
				<!--<h2>烘焙</h2>-->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">操作流程：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">负责人：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">工艺名称：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" name="" id="" placeholder="" value="" class="input-text">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
			<!--</form>-->
			<!---->
			<!--<form action="" method="post" class="form form-horizontal" id="form-article-add" style="">-->
				<!--<h2>自然晾干</h2>-->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">操作流程：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">负责人：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" class="input-text" value="" placeholder="" id="" name="">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
				<!---->
				<!--<div class="row cl">-->
					<!--<label class="form-label col-xs-4 col-sm-2">工艺名称：</label>-->
					<!--<div class="formControls col-xs-6 col-sm-6">-->
						<!--<input type="text" name="" id="" placeholder="" value="" class="input-text">-->
					<!--</div>-->
				<!--</div>-->
				<!---->
			<!--</form>-->

		</div>
		<div th:include="include::footer"></div>
	<script  type="text/javascript" th:inline="javascript">
        function getTraceabilityFileId(){
            var traceabilityFileId = [[${traceabilityFileId}]];
            return traceabilityFileId;
        }
		$(function () {
            getData()
        })

		function getData() {
            $.ajax({
                url:  getContext()+"/traceability/tyMenu/getTyMenuByTraceabilityFileId/"+getTraceabilityFileId(),
                type: "GET",
                success: function (result) {
                    if (result.success) {
                        console.log(result.data)
                        var dataList = result.data;
                        var htmlText = "<form action='' method='post' class='form form-horizontal' id='form-article-add' style=''>"
                        for(var item in dataList){
                            var tyMenu = dataList[item].tyMenu;
                            var tyMenuDataList = dataList[item].tyMenuDataList;
							var contentText = "";
                            contentText += "<div name='menu' class='row cl'>"
                            contentText += "<h2 name='menuName'>"+ tyMenu.menuName +"</h2>"
                            for (var i in tyMenuDataList){
                                contentText += "<div class='row cl'>"
                                contentText += "<label class='form-label col-xs-4 col-sm-2' name='dataKey'>"+tyMenuDataList[i].dataKey+"</label>"
                                contentText += "<div class='formControls col-xs-6 col-sm-6'>"
                                contentText += "<input type='text' class='input-text' value='"+tyMenuDataList[i].dataValue+"' placeholder='' id='' readonly='readonly' name='dataValue'>"
                                contentText += "</div>"
                                contentText += "</div>"
							}
                            contentText += "</div>"
							htmlText += contentText;
						}

                        htmlText += "<div class='row cl'>" +
//                            "<div class='col-4 pull-left'>"+
//                            "<input type='button' class='btn btn-default radius' value='&nbsp;&nbsp;取消&nbsp;&nbsp;' onclick='javascript:window.parent.location.reload()'>" +
//                            "</div>"+
                            "</div>"
                        htmlText += "</form>"
						$("#dataContainer").append(htmlText)

                    } else {
                        layer.msg(result.message)
                    }
                },
                error: function (result) {
                    layer.msg("网络错误，请稍后重新操作")
                }
            });
        }

        function generateData() {
		    var menuDiv =  $("div[name='menu']");
		    var result = new Array();
			for (var i = 0; i<menuDiv.length;i++){
		        var menu = menuDiv[i];
		        var menuName = $(menu).children('h2').text();
                var dataArr = new Array();
                var div = $(menu).children('div');
				for (var x = 0; x <div.length; x++){
                    var divData = div[x];
                    var dataKey = $(divData).find('label').text()
					var dataValue = $(divData).find('input').val()
					var data = {dataKey:dataKey,dataValue:dataValue}
					dataArr.push(data)
                }
                var obj = {menuName:menuName,tyMenuDataList:dataArr}
                result.push(obj)
			}
//			console.log(JSON.stringify(result))
			return result;
        }

        function addData() {
			var obj = {tyMenuDataKyVOList:generateData()}
            console.log(JSON.stringify(obj))
            $.ajax({
                url: getContext() + "tyMenu/saveTyMenuVO/"+ getParameter("trId"),
                type: "POST",
				dataType: "json",
                contentType:"application/json",
                data: JSON.stringify(generateData()),
                success: function (result) {
                    console.log(result)
                },
                error: function (result) {
                    layer.msg("网络错误，请稍后重新操作")
                }
            });
        }

	</script>
	</body>

</html>