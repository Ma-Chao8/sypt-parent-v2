<!DOCTYPE html>
<html lang="ch" xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8">
<meta name="viewport"
      content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
<meta name="ctxPath" th:content="@{/}">
<head th:include="include::header"></head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="container-fluid">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>添加</h5>
                </div>
                <div class="ibox-content">
                    <form class="form-horizontal m-t" id="dataForm">
                        <input name="companyId" th:value="${company.companyId}" type="hidden">

                        <div class="form-group">
                            <label class="col-sm-3 control-label">商户名称：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="companyName" th:value="${company.companyName}" class="form-control"
                                       type="text" required autocomplete="off"
                                       placeholder="商户名称（必填）">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">产品标识：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="productIdent" th:value="${company.productIdent}" class="form-control" type="text" required autocomplete="off"
                                       placeholder="产品标识（必填）">
                            </div>
                        </div>


                        <div class="form-group">
                            <label class="col-sm-3 control-label">企业法人：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="companyLegalPerson" th:value="${company.companyLegalPerson}"
                                       class="form-control" type="text"
                                       required
                                       autocomplete="off" placeholder="企业法人（必填）">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">联系人：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="linkman" th:value="${company.linkman}" class="form-control" type="text"
                                       required
                                       autocomplete="off"
                                       placeholder="联系人（必填）">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">联系电话：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="tel" th:value="${company.tel}" class="form-control" type="text" required
                                       autocomplete="off"
                                       placeholder="联系电话（必填）">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">公司地址：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="companyAddress" th:value="${company.companyAddress}" class="form-control"
                                       type="text" required
                                       autocomplete="off" placeholder="公司地址（必填）">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">公司等级：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="level" th:value="${company.level}" class="form-control" type="text"
                                       required autocomplete="off"
                                       placeholder="公司等级（必填,例：1、3、5星级企业）">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">公司评级：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="rank" th:value="${company.rank}" class="form-control" type="text" required
                                       autocomplete="off"
                                       placeholder="公司评级（必填，例：省评级、省龙头企业、市龙头企业）">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">公司介绍：</label>
                            <div class="col-sm-8">
                                <textarea name="introduce" th:text="${company.introduce}" class="form-control" rows="5" autocomplete="off"
                                          placeholder="公司介绍"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">经度：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="longitude" th:value="${company.longitude}" class="form-control" type="text"
                                       required autocomplete="off"
                                       placeholder="经度（必填）">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">维度：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="latitude" th:value="${company.latitude}" class="form-control" type="text"
                                       required autocomplete="off"
                                       placeholder="纬度（必填）">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">商户Logo：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <input name="logo" th:value="${company.logo}" hidden>
                                <img name="logoImg" th:src="${company.logo}" src="" style="width: 100px; height: 100px;">
                                <a class="btn btn-success" data-operate="imgSelect">上传Logo</a>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">行业：<i style="color: red">*</i></label>
                            <div class="col-sm-8">
                                <select name="industryId" id="industryId" class="form-control">

                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">大码匹配规则：</label>
                            <div class="col-sm-8">
                                <input name="bigCodeConfig" th:value="${company.bigCodeConfig}" class="form-control" required autocomplete="off"
                                       placeholder="大码匹配规则">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label">小码匹配规则：</label>
                            <div class="col-sm-8">
                                <input name="smallCodeConfig" th:value="${company.smallCodeConfig}" class="form-control"  required autocomplete="off"
                                       placeholder="小码匹配规则">
                            </div>
                        </div>


                        <div class="form-group">
                            <div class="col-sm-8 col-sm-offset-3">
                                <button type="submit" class="btn btn-primary">提交</button>
                                <input type="button" class="btn btn-danger" value="取消"
                                       onclick="javascript:
											var index = parent.layer.getFrameIndex(window.name); // 获取窗口索引
				                            parent.layer.close(index);">
                                </input>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:include="include::footer"></div>
<script type="text/javascript" th:inline="javascript">
    +function () {
        var industryId = [[${company.industryId}]]
        getIndustryByUpdate(industryId)
        var ctx = $("meta[name=ctxPath]").attr("content");
        $("#dataForm").validate({
            rules: {
                productName: {required: true}
            },
            messages: {
                productName: {
                    required: '<span><i class="fa fa-times-circle"></i>产品名称不能为空</span>'
                }
            },
            submitHandler: function (form) {
                $.ajax({
                    cache: true,
                    type: "POST",
                    url: ctx + "company/edit",
                    data: $(form).serialize(),
                    success: function (result) {
                        parent.layer.msg(result.msg);
                        if (result.code == 0) {
                            var index = parent.layer.getFrameIndex(window.name); // 获取窗口索引
                            parent.layer.close(index);
                            parent.tableReload();
                        }
                    },
                    error: function (error) {
                        layer.alert("网络链接错误，请稍后重新操作");
                    }
                });
            }
        });

        var imgSelectWindow;
        $(document).on("click", "*[data-operate]", function () {
            console.log(this)
            switch ($(this).attr("data-operate")) {
                case "imgSelect": {
                    imgSelectWindow = layer.open({
                        type: 2,
                        title: '选择图片',
                        shadeClose: false,
                        shade: 0.8,
                        area: ['100%', '100%'],
                        content: ctx + 'common/sysFile/img/list' //iframe的url
                    });
                    break;
                }
            }
        });


        window.imgSelect = function (ele) {
            //console.log(ele);
            if (imgSelectWindow) {
                layer.close(imgSelectWindow);
            }
            //
            var url = $(ele).find("img").attr("src");
            $("img[name=logoImg]").attr("src", url);
            $("input[name=logo]").val(url);
        };
    }();

</script>
</body>

</html>
